area_total*(crop_yield*crop_removal+cr_yield*crop_residue_removal)/(crop_yield*crop_removal+cr_yield*crop_residue_removal)),
rough_of = ifelse(stringr::str_detect(selected_feed$feed, "OFR"), area_feed, 0),
conc_of = ifelse(stringr::str_detect(selected_feed$feed, "OFC"), area_feed, 0),
conc_ip = ifelse(stringr::str_detect(selected_feed$feed, "IP"), area_feed, 0),
farm = sum(area_feed, rough_of, conc_of, conc_ip),
grasses = ifelse(feed_item_selected$category == "grass", area_feed, 0),
tree_legume = ifelse(feed_item_selected$category == "tree crop" | feed_item_selected$category == "tree legume", area_feed, 0)) %>%
dplyr::mutate_if(is.numeric, list(~na_if(.,Inf))) %>%
replace(is.na(.), 0)
view(land_requirements[[1]])
land_requirements[[1]]$crop_residue_removal
feed_item_selected$main_product_removal
feed_item_selected$residue_removal
feed_item_selected$source_type
library(cleaned)
library(jsonlite)
library(tidyverse)
para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
ghg_ipcc_data <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
energy_parameters <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
stock_change_para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
feed_basket_quality <- feed_quality(para)
energy_required <- energy_requirement(para,feed_basket_quality,energy_parameters)
land_required <- land_requirement(feed_basket_quality, energy_required, para)
para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
feed_basket_quality <- feed_quality(para)
energy_required <- energy_requirement(para,feed_basket_quality,energy_parameters)
land_required <- land_requirement(feed_basket_quality, energy_required, para)
soil_erosion <- soil_health(para, land_required)
water_required <- water_requirement(para, land_required)
nitrogen_balance <- n_balance(para, land_required, soil_erosion)
livestock_productivity <- land_productivity(para)
economics <- economics_payback(para, energy_required, livestock_productivity)
biomass <- biomass_calculation(para, land_required)
soil_carbon <- soil_organic_carbon(para, stock_change_para, land_required, biomass)
ghg_emissions <- ghg_emission(para,energy_required,ghg_ipcc_data,land_required,nitrogen_balance)
bp <-  combineOutputs(feed_basket_quality,energy_required,land_required,soil_erosion,water_required,
nitrogen_balance,livestock_productivity,economics,biomass,soil_carbon,ghg_emissions)
bp
para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
calculate_differences <- function(...){
outputList <- list(...)
print(outputList)
}
para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
feed_basket_quality <- feed_quality(para)
energy_required <- energy_requirement(para,feed_basket_quality,energy_parameters)
land_required <- land_requirement(feed_basket_quality, energy_required, para)
soil_erosion <- soil_health(para, land_required)
water_required <- water_requirement(para, land_required)
nitrogen_balance <- n_balance(para, land_required, soil_erosion)
livestock_productivity <- land_productivity(para)
economics <- economics_payback(para, energy_required, livestock_productivity)
biomass <- biomass_calculation(para, land_required)
soil_carbon <- soil_organic_carbon(para, stock_change_para, land_required, biomass)
ghg_emissions <- ghg_emission(para,energy_required,ghg_ipcc_data,land_required,nitrogen_balance)
lb <-  combineOutputs(feed_basket_quality,energy_required,land_required,soil_erosion,water_required,
nitrogen_balance,livestock_productivity,economics,biomass,soil_carbon,ghg_emissions)
para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
feed_basket_quality <- feed_quality(para)
energy_required <- energy_requirement(para,feed_basket_quality,energy_parameters)
land_required <- land_requirement(feed_basket_quality, energy_required, para)
soil_erosion <- soil_health(para, land_required)
water_required <- water_requirement(para, land_required)
nitrogen_balance <- n_balance(para, land_required, soil_erosion)
livestock_productivity <- land_productivity(para)
economics <- economics_payback(para, energy_required, livestock_productivity)
biomass <- biomass_calculation(para, land_required)
soil_carbon <- soil_organic_carbon(para, stock_change_para, land_required, biomass)
ghg_emissions <- ghg_emission(para,energy_required,ghg_ipcc_data,land_required,nitrogen_balance)
lb <-  combineOutputs(feed_basket_quality,energy_required,land_required,soil_erosion,water_required,
nitrogen_balance,livestock_productivity,economics,biomass,soil_carbon,ghg_emissions)
calculate_differences(lb,bp)
calculate_differences <- function(...){
outputList <- list(...)
names(outputList)
}
calculate_differences(lb,bp)
calculate_differences <- function(...){
outputList <- list(...)
length(outputList)
}
calculate_differences(lb,bp)
557748+9400
outputList <- list(lb,bp)
outputList
scenarioList <- list()
outputList[1]
output <- jsonlite::fromJSON(outputList[1], flatten = TRUE)
test <- outputList[1]
View(test)
test[[1]]
test[[1]]
output <- jsonlite::fromJSON(outputList[[1]], flatten = TRUE)
i=1
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
scenario <- gsub(".*(output_|\\s)(.*).json", "\\2", i)
scenario
calculate_differences <- function(...){
outputList <- list(...)
if (length(outputList)==0) {
stop("No files in source directory")
} else {
scenarioList <- list()
for (i in outputList){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_m3_yr <- sum(land_required$area_feed)*sum(water_requirement$water_use_per_feed_item$ET)
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
watermilk_m3_kg <- ifelse(is.na(water_m3_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, water_m3_yr/sum(output[["livestock_productivity"]]$total_milk))
waterprotein_m3_kg <- ifelse(is.na(water_m3_yr/(sum(output[["livestock_productivity"]]$protein_kg_year_meat)+sum(output[["livestock_productivity"]]$protein_kg_year_milk))), 0, water_m3_yr/(sum(output[["livestock_productivity"]]$protein_kg_year_meat)+sum(output[["livestock_productivity"]]$protein_kg_year_milk)))
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
water_m3_yr,
waterha_m3_ha,
watermilk_m3_kg,
waterprotein_m3_kg)
}
}
results <- scenarioList %>% dplyr::bind_rows()
return(results)
}
diff <- calculate_differences(lb,bp)
scenario_comparison <- function(...){
outputList <- list(...)
if (length(outputList)==0) {
stop("No files in source directory")
} else {
scenarioList <- list()
for (i in outputList){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_m3_yr <- sum(land_required$area_feed)*sum(water_requirement$water_use_per_feed_item$ET)
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
watermilk_m3_kg <- ifelse(is.na(water_m3_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, water_m3_yr/sum(output[["livestock_productivity"]]$total_milk))
waterprotein_m3_kg <- ifelse(is.na(water_m3_yr/(sum(output[["livestock_productivity"]]$protein_kg_year_meat)+sum(output[["livestock_productivity"]]$protein_kg_year_milk))), 0, water_m3_yr/(sum(output[["livestock_productivity"]]$protein_kg_year_meat)+sum(output[["livestock_productivity"]]$protein_kg_year_milk)))
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
water_m3_yr,
waterha_m3_ha,
watermilk_m3_kg,
waterprotein_m3_kg)
}
}
results <- scenarioList %>% dplyr::bind_rows()
return(results)
}
diff <-scenario_comparison(lb,bp)
outputList <- list(lb,bp)
scenarioList <- list()
for (i in outputList){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_m3_yr <- sum(land_required$area_feed)*sum(water_requirement$water_use_per_feed_item$ET)
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
watermilk_m3_kg <- ifelse(is.na(water_m3_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, water_m3_yr/sum(output[["livestock_productivity"]]$total_milk))
waterprotein_m3_kg <- ifelse(is.na(water_m3_yr/(sum(output[["livestock_productivity"]]$protein_kg_year_meat)+sum(output[["livestock_productivity"]]$protein_kg_year_milk))), 0, water_m3_yr/(sum(output[["livestock_productivity"]]$protein_kg_year_meat)+sum(output[["livestock_productivity"]]$protein_kg_year_milk)))
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
water_m3_yr,
waterha_m3_ha,
watermilk_m3_kg,
waterprotein_m3_kg)
}
i=1
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_m3_yr <- sum(land_required$area_feed)*sum(water_requirement$water_use_per_feed_item$ET)
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
watermilk_m3_kg <- ifelse(is.na(water_m3_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, water_m3_yr/sum(output[["livestock_productivity"]]$total_milk))
waterprotein_m3_kg <- ifelse(is.na(water_m3_yr/(sum(output[["livestock_productivity"]]$protein_kg_year_meat)+sum(output[["livestock_productivity"]]$protein_kg_year_milk))), 0, water_m3_yr/(sum(output[["livestock_productivity"]]$protein_kg_year_meat)+sum(output[["livestock_productivity"]]$protein_kg_year_milk)))
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
water_m3_yr,
waterha_m3_ha,
watermilk_m3_kg,
waterprotein_m3_kg)
View(scenarioList)
View(scenarioList[[1]])
scenarioList[[1]]
i=2
scenario_comparison <- function(...){
outputList <- list(...)
if (length(outputList)==0) {
stop("No files in source directory")
} else {
scenarioList <- list()
for (i in 1:length(outputList)){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_m3_yr <- sum(land_required$area_feed)*sum(water_requirement$water_use_per_feed_item$ET)
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
watermilk_m3_kg <- ifelse(is.na(water_m3_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, water_m3_yr/sum(output[["livestock_productivity"]]$total_milk))
waterprotein_m3_kg <- ifelse(is.na(water_m3_yr/(sum(output[["livestock_productivity"]]$protein_kg_year_meat)+sum(output[["livestock_productivity"]]$protein_kg_year_milk))), 0, water_m3_yr/(sum(output[["livestock_productivity"]]$protein_kg_year_meat)+sum(output[["livestock_productivity"]]$protein_kg_year_milk)))
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
water_m3_yr,
waterha_m3_ha,
watermilk_m3_kg,
waterprotein_m3_kg)
}
}
results <- scenarioList %>% dplyr::bind_rows()
return(results)
}
diff <-scenario_comparison(lb,bp)
View(diff)
library(cleaned)
rm(list = ls())
library(cleaned)
library(jsonlite)
library(tidyverse)
para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
ghg_ipcc_data <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
energy_parameters <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
stock_change_para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
feed_basket_quality <- feed_quality(para)
energy_required <- energy_requirement(para,feed_basket_quality,energy_parameters)
land_required <- land_requirement(feed_basket_quality, energy_required, para)
soil_erosion <- soil_health(para, land_required)
water_required <- water_requirement(para, land_required)
nitrogen_balance <- n_balance(para, land_required, soil_erosion)
livestock_productivity <- land_productivity(para)
economics <- economics_payback(para, energy_required, livestock_productivity)
biomass <- biomass_calculation(para, land_required)
soil_carbon <- soil_organic_carbon(para, stock_change_para, land_required, biomass)
ghg_emissions <- ghg_emission(para,energy_required,ghg_ipcc_data,land_required,nitrogen_balance)
bp <-  combineOutputs(feed_basket_quality,energy_required,land_required,soil_erosion,water_required,
nitrogen_balance,livestock_productivity,economics,biomass,soil_carbon,ghg_emissions)
para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
feed_basket_quality <- feed_quality(para)
energy_required <- energy_requirement(para,feed_basket_quality,energy_parameters)
land_required <- land_requirement(feed_basket_quality, energy_required, para)
soil_erosion <- soil_health(para, land_required)
water_required <- water_requirement(para, land_required)
nitrogen_balance <- n_balance(para, land_required, soil_erosion)
livestock_productivity <- land_productivity(para)
economics <- economics_payback(para, energy_required, livestock_productivity)
biomass <- biomass_calculation(para, land_required)
soil_carbon <- soil_organic_carbon(para, stock_change_para, land_required, biomass)
ghg_emissions <- ghg_emission(para,energy_required,ghg_ipcc_data,land_required,nitrogen_balance)
lb <-  combineOutputs(feed_basket_quality,energy_required,land_required,soil_erosion,water_required,
nitrogen_balance,livestock_productivity,economics,biomass,soil_carbon,ghg_emissions)
diff <-scenario_comparison(lb,bp)
library(cleaned)
diff <- calculate_differences(lb,bp)
diff
View(diff)
View(water_required)
water_requirement <- lb[["water_required"]]
outputList <- list(lb,bp)
i=1
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
water_requirement <- output[["water_required"]]
View(water_requirement)
View(water_requirement[[1]])
View(water_requirement[[2]])
water_requirement$water_use_per_feed_item$ET
names(water_requirement)
water_requirement[["water_use_per_feed_item"]]
water_requirement[["water_use_for_production"]]
water_requirement[["water_use_for_production"]][which(water_requirement[["water_use_for_production"]]$Names==ET),2]
water_requirement[["water_use_for_production"]][which(water_requirement[["water_use_for_production"]]$Names=="ET"),2]
percent_of_precipitation_used_for_feed_production <- water_requirement[["water_use_for_production"]][which(water_requirement[["water_use_for_production"]]$Names=="fraction_of_precipitation_used_for_feed_production"),2]
percent_of_precipitation_used_for_feed_production
percent_of_precipitation_used_for_feed_production <- water_requirement[["water_use_for_production"]][which(water_requirement[["water_use_for_production"]]$Names=="fraction_of_precipitation_used_for_feed_production"),2]*100
percent_of_precipitation_used_for_feed_production
sum(water_requirement[["water_use_per_feed_item"]]$water_use)
View(diff)
calculate_differences <- function(...){
outputList <- list(...)
if (length(outputList)==0) {
stop("No files in source directory")
} else {
scenarioList <- list()
for (i in 1:length(outputList)){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
percent_of_precipitation_used_for_feed_production <- water_requirement[["water_use_for_production"]][which(water_requirement[["water_use_for_production"]]$Names=="fraction_of_precipitation_used_for_feed_production"),2]*100
water_m3_yr <- water_requirement[["water_use_for_production"]][which(water_requirement[["water_use_for_production"]]$Names=="total_water_use"),2]
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
water_use_perkg_fpcm <- water_requirement[["water_use_for_production"]][which(water_requirement[["water_use_for_production"]]$Names=="water_use_fpcm"),2]
water_use_perkg_meat <- water_requirement[["water_use_for_production"]][which(water_requirement[["water_use_for_production"]]$Names=="water_use_meat"),2]
water_use_perkg_protein <- water_requirement[["water_use_for_production"]][which(water_requirement[["water_use_for_production"]]$Names=="water_use_protein"),2]
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
percent_of_precipitation_used_for_feed_production,
water_m3_yr,
waterha_m3_ha,
water_use_perkg_fpcm,
water_use_perkg_meat,
water_use_perkg_protein)
}
}
results <- scenarioList %>% dplyr::bind_rows()
return(results)
}
diff <- calculate_differences(lb,bp)
View(diff)
