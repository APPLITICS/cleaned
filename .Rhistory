stop("Number of variables is not enough")
} else {
scenarioList <- list()
for (i in 2:length(outputList)){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_use_for_production <- as.data.frame(water_requirement[["water_use_for_production"]])
percent_of_precipitation_used_for_feed_production <- water_use_for_production[which(water_use_for_production$Names=="fraction_of_precipitation_used_for_feed_production"),2]*100
water_m3_yr <-water_use_for_production[which(water_use_for_production$Names=="total_water_use"),2]
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
water_use_perkg_fpcm <- water_use_for_production[which(water_use_for_production$Names=="water_use_fpcm"),2]
water_use_perkg_meat <- water_use_for_production[which(water_use_for_production$Names=="water_use_meat"),2]
water_use_perkg_protein <- water_use_for_production[which(water_use_for_production$Names=="water_use_protein"),2]
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
percent_of_precipitation_used_for_feed_production,
water_m3_yr,
waterha_m3_ha,
water_use_perkg_fpcm,
water_use_perkg_meat,
water_use_perkg_protein)
}
}
results <- scenarioList %>% dplyr::bind_rows()
write(jsonlite::toJSON(results, pretty = TRUE),outputList[[1]])
}
diff <- calculate_differences("C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/steve_test.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json")
outputList <- list("C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/steve_test.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json")
length(outputList)
if (length(outputList) < 3) {
stop("Number of variables is not enough")
} else {
scenarioList <- list()
for (i in 2:length(outputList)){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_use_for_production <- as.data.frame(water_requirement[["water_use_for_production"]])
percent_of_precipitation_used_for_feed_production <- water_use_for_production[which(water_use_for_production$Names=="fraction_of_precipitation_used_for_feed_production"),2]*100
water_m3_yr <-water_use_for_production[which(water_use_for_production$Names=="total_water_use"),2]
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
water_use_perkg_fpcm <- water_use_for_production[which(water_use_for_production$Names=="water_use_fpcm"),2]
water_use_perkg_meat <- water_use_for_production[which(water_use_for_production$Names=="water_use_meat"),2]
water_use_perkg_protein <- water_use_for_production[which(water_use_for_production$Names=="water_use_protein"),2]
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
percent_of_precipitation_used_for_feed_production,
water_m3_yr,
waterha_m3_ha,
water_use_perkg_fpcm,
water_use_perkg_meat,
water_use_perkg_protein)
}
}
diff <- calculate_differences("C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/steve_test.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json")
for (i in 2:length(outputList)){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_use_for_production <- as.data.frame(water_requirement[["water_use_for_production"]])
percent_of_precipitation_used_for_feed_production <- water_use_for_production[which(water_use_for_production$Names=="fraction_of_precipitation_used_for_feed_production"),2]*100
water_m3_yr <-water_use_for_production[which(water_use_for_production$Names=="total_water_use"),2]
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
water_use_perkg_fpcm <- water_use_for_production[which(water_use_for_production$Names=="water_use_fpcm"),2]
water_use_perkg_meat <- water_use_for_production[which(water_use_for_production$Names=="water_use_meat"),2]
water_use_perkg_protein <- water_use_for_production[which(water_use_for_production$Names=="water_use_protein"),2]
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
percent_of_precipitation_used_for_feed_production,
water_m3_yr,
waterha_m3_ha,
water_use_perkg_fpcm,
water_use_perkg_meat,
water_use_perkg_protein)
}
View(scenarioList)
lst = list(1, 2, 3)
lst[[1]] <- NULL
length(lst)
lst = list(1, 2, 3)
length(lst)
rm(list = ls())
outputList <- list("C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/steve_test.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json")
output_path <- outputList[[1]] # output directory
outputList[[1]] <- NULL
if (length(outputList) == 0) {
stop("No files in source directory")
} else {
scenarioList <- list()
for (i in 2:length(outputList)){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_use_for_production <- as.data.frame(water_requirement[["water_use_for_production"]])
percent_of_precipitation_used_for_feed_production <- water_use_for_production[which(water_use_for_production$Names=="fraction_of_precipitation_used_for_feed_production"),2]*100
water_m3_yr <-water_use_for_production[which(water_use_for_production$Names=="total_water_use"),2]
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
water_use_perkg_fpcm <- water_use_for_production[which(water_use_for_production$Names=="water_use_fpcm"),2]
water_use_perkg_meat <- water_use_for_production[which(water_use_for_production$Names=="water_use_meat"),2]
water_use_perkg_protein <- water_use_for_production[which(water_use_for_production$Names=="water_use_protein"),2]
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
percent_of_precipitation_used_for_feed_production,
water_m3_yr,
waterha_m3_ha,
water_use_perkg_fpcm,
water_use_perkg_meat,
water_use_perkg_protein)
}
}
results <- scenarioList %>% dplyr::bind_rows()
write(jsonlite::toJSON(results, pretty = TRUE),output_path)
rm(list = ls())
calculate_differences <- function(a,b,c,...){
outputList <- list(...)
output_path <- outputList[[1]] # output directory
outputList[[1]] <- NULL
if (length(outputList) == 0) {
stop("No files in source directory")
} else {
scenarioList <- list()
for (i in 2:length(outputList)){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_use_for_production <- as.data.frame(water_requirement[["water_use_for_production"]])
percent_of_precipitation_used_for_feed_production <- water_use_for_production[which(water_use_for_production$Names=="fraction_of_precipitation_used_for_feed_production"),2]*100
water_m3_yr <-water_use_for_production[which(water_use_for_production$Names=="total_water_use"),2]
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
water_use_perkg_fpcm <- water_use_for_production[which(water_use_for_production$Names=="water_use_fpcm"),2]
water_use_perkg_meat <- water_use_for_production[which(water_use_for_production$Names=="water_use_meat"),2]
water_use_perkg_protein <- water_use_for_production[which(water_use_for_production$Names=="water_use_protein"),2]
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
percent_of_precipitation_used_for_feed_production,
water_m3_yr,
waterha_m3_ha,
water_use_perkg_fpcm,
water_use_perkg_meat,
water_use_perkg_protein)
}
}
results <- scenarioList %>% dplyr::bind_rows()
write(jsonlite::toJSON(results, pretty = TRUE),output_path)
}
calculate_differences("C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/steve_test.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json")
calculate_differences("C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/steve_test.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json")
calculate_differences <- function(outDir,...){
output_path <- outDir # output directory
outputList <- list(...)
outputList[[1]] <- NULL
if (length(outputList) == 0) {
stop("No files in source directory")
} else {
scenarioList <- list()
for (i in 2:length(outputList)){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_use_for_production <- as.data.frame(water_requirement[["water_use_for_production"]])
percent_of_precipitation_used_for_feed_production <- water_use_for_production[which(water_use_for_production$Names=="fraction_of_precipitation_used_for_feed_production"),2]*100
water_m3_yr <-water_use_for_production[which(water_use_for_production$Names=="total_water_use"),2]
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
water_use_perkg_fpcm <- water_use_for_production[which(water_use_for_production$Names=="water_use_fpcm"),2]
water_use_perkg_meat <- water_use_for_production[which(water_use_for_production$Names=="water_use_meat"),2]
water_use_perkg_protein <- water_use_for_production[which(water_use_for_production$Names=="water_use_protein"),2]
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
percent_of_precipitation_used_for_feed_production,
water_m3_yr,
waterha_m3_ha,
water_use_perkg_fpcm,
water_use_perkg_meat,
water_use_perkg_protein)
}
}
results <- scenarioList %>% dplyr::bind_rows()
write(jsonlite::toJSON(results, pretty = TRUE),output_path)
}
calculate_differences("C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/steve_test.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json")
calculate_differences <- function(outDir,...){
outputList <- list(outDir = outDir,...)
output_path <- outputList[["outDir"]]
outputList[[1]] <- NULL
if (length(outputList) == 0) {
stop("No files in source directory")
} else {
scenarioList <- list()
for (i in 1:length(outputList)){
scenario <- i
output <- jsonlite::fromJSON(outputList[[i]], flatten = TRUE)
nitrogen_balance <- output[["nitrogen_balance"]]
soil_mining_perc <- sum(nitrogen_balance[nitrogen_balance$area_total > 0.9,]$area_total)*100/sum(nitrogen_balance$area_total)
soil_leaching_perc <- sum(nitrogen_balance[nitrogen_balance$area_total < 0.5,]$area_total)*100/sum(nitrogen_balance$area_total)
erosion_tyr <- sum(as.numeric(output[["soil_erosion"]]$soil_loss_plot))
land_required <- output[["land_required"]] %>%
dplyr::bind_rows()
erosion_thayr <- sum(land_required$area_feed)/erosion_tyr
average_annual_milk_kg_yr <- sum(output[["livestock_productivity"]]$total_milk)
erosion_kgsoil_kg_fpcm <- ifelse(is.na(erosion_tyr/sum(output[["livestock_productivity"]]$total_milk)), 0, erosion_tyr/sum(output[["livestock_productivity"]]$total_milk))*1000
land_requirement_ha <- sum(land_required$area_feed)
total_land_required_ha_mt_fpcm <- ifelse(is.na(land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk)), 0, land_requirement_ha/sum(output[["livestock_productivity"]]$total_milk))*1000
ghg_emission <- output[["ghg_emission"]]
ghgtot_t_co2eq_yr <- (sum(ghg_emission$kg_per_ha,na.rm = T)/1000)*land_requirement_ha
ghgtot_t_co2eq_ha_yr <- sum(ghg_emission$kg_per_ha,na.rm = T)/1000
ghgmeat_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$meat_production_animal))
ghgmilk_kg_co2eq_kg <- ifelse(is.na(ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk)), 0, ghgtot_t_co2eq_yr/sum(output[["livestock_productivity"]]$total_milk))
tot_protein_kg_year_meat <- sum(output[["livestock_productivity"]]$protein_kg_year_meat)
tot_protein_kg_year_milk <- sum(output[["livestock_productivity"]]$protein_kg_year_milk)
ghgprotein_kg_co2eq_kg <- ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk == 0,0,
ifelse(tot_protein_kg_year_meat==0 & tot_protein_kg_year_milk != 0, ghgtot_t_co2eq_yr/tot_protein_kg_year_milk,
ifelse(tot_protein_kg_year_meat!=0 & tot_protein_kg_year_milk == 0,ghgtot_t_co2eq_yr/tot_protein_kg_year_meat,
(ghgtot_t_co2eq_yr/tot_protein_kg_year_milk)+(ghgtot_t_co2eq_yr/tot_protein_kg_year_meat))))
water_requirement <- output[["water_required"]]
water_use_for_production <- as.data.frame(water_requirement[["water_use_for_production"]])
percent_of_precipitation_used_for_feed_production <- water_use_for_production[which(water_use_for_production$Names=="fraction_of_precipitation_used_for_feed_production"),2]*100
water_m3_yr <-water_use_for_production[which(water_use_for_production$Names=="total_water_use"),2]
waterha_m3_ha <- water_m3_yr/sum(land_required$area_feed)
water_use_perkg_fpcm <- water_use_for_production[which(water_use_for_production$Names=="water_use_fpcm"),2]
water_use_perkg_meat <- water_use_for_production[which(water_use_for_production$Names=="water_use_meat"),2]
water_use_perkg_protein <- water_use_for_production[which(water_use_for_production$Names=="water_use_protein"),2]
scenarioList[[i]] <- data.frame(scenario,
average_annual_milk_kg_yr,
soil_mining_perc,
soil_leaching_perc,
erosion_tyr,
erosion_thayr,
erosion_kgsoil_kg_fpcm,
land_requirement_ha,
total_land_required_ha_mt_fpcm,
ghgtot_t_co2eq_yr,
ghgtot_t_co2eq_ha_yr,
ghgmilk_kg_co2eq_kg,
ghgmeat_kg_co2eq_kg,
ghgprotein_kg_co2eq_kg,
percent_of_precipitation_used_for_feed_production,
water_m3_yr,
waterha_m3_ha,
water_use_perkg_fpcm,
water_use_perkg_meat,
water_use_perkg_protein)
}
}
results <- scenarioList %>% dplyr::bind_rows()
write(jsonlite::toJSON(results, pretty = TRUE),output_path)
}
calculate_differences("C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/steve_test.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json")
packageVersion("cleaned")
if (packageVersion("cleaned") != ‘0.3.1’) {
print("NO")
}else{print("yes")}
if (packageVersion("cleaned") != '0.3.1') {
print("NO")
}else{print("yes")}
library(cleaned)
rm(list = ls())
library(jsonlite)
library(tidyverse)
para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
ghg_ipcc_data <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
energy_parameters <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
stock_change_para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
feed_basket_quality <- feed_quality(para)
energy_required <- energy_requirement(para,feed_basket_quality,energy_parameters)
land_required <- land_requirement(feed_basket_quality, energy_required, para)
soil_erosion <- soil_health(para, land_required)
water_required <- water_requirement(para, land_required)
nitrogen_balance <- n_balance(para, land_required, soil_erosion)
livestock_productivity <- land_productivity(para)
economics <- economics_payback(para, energy_required, livestock_productivity)
biomass <- biomass_calculation(para, land_required)
soil_carbon <- soil_organic_carbon(para, stock_change_para, land_required, biomass)
ghg_emissions <- ghg_emission(para,energy_required,ghg_ipcc_data,land_required,nitrogen_balance)
bp <-  combineOutputs(feed_basket_quality,energy_required,land_required,soil_erosion,water_required,
nitrogen_balance,livestock_productivity,economics,biomass,soil_carbon,ghg_emissions)
write(bp, "C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json")
para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
feed_basket_quality <- feed_quality(para)
energy_required <- energy_requirement(para,feed_basket_quality,energy_parameters)
land_required <- land_requirement(feed_basket_quality, energy_required, para)
soil_erosion <- soil_health(para, land_required)
water_required <- water_requirement(para, land_required)
nitrogen_balance <- n_balance(para, land_required, soil_erosion)
livestock_productivity <- land_productivity(para)
economics <- economics_payback(para, energy_required, livestock_productivity)
biomass <- biomass_calculation(para, land_required)
soil_carbon <- soil_organic_carbon(para, stock_change_para, land_required, biomass)
ghg_emissions <- ghg_emission(para,energy_required,ghg_ipcc_data,land_required,nitrogen_balance)
lb <-  combineOutputs(feed_basket_quality,energy_required,land_required,soil_erosion,water_required,
nitrogen_balance,livestock_productivity,economics,biomass,soil_carbon,ghg_emissions)
write(lb, "C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json")
para <- fromJSON(file.choose(),  flatten = TRUE, simplifyDataFrame = TRUE)
feed_basket_quality <- feed_quality(para)
energy_required <- energy_requirement(para,feed_basket_quality,energy_parameters)
land_required <- land_requirement(feed_basket_quality, energy_required, para)
soil_erosion <- soil_health(para, land_required)
water_required <- water_requirement(para, land_required)
nitrogen_balance <- n_balance(para, land_required, soil_erosion)
livestock_productivity <- land_productivity(para)
economics <- economics_payback(para, energy_required, livestock_productivity)
biomass <- biomass_calculation(para, land_required)
soil_carbon <- soil_organic_carbon(para, stock_change_para, land_required, biomass)
ghg_emissions <- ghg_emission(para,energy_required,ghg_ipcc_data,land_required,nitrogen_balance)
bp <-  combineOutputs(feed_basket_quality,energy_required,land_required,soil_erosion,water_required,
nitrogen_balance,livestock_productivity,economics,biomass,soil_carbon,ghg_emissions)
write(bp, "C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_PB.json")
calculate_differences("C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/steve_test.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_LB.json","C:/Users/Soloo/OneDrive - CGIAR/Documents/ILRI work/Projects/CLEANED-XtRa/outputs/output_SB_II_PB.json")
